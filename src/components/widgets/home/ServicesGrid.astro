---
import type { ImageMetadata } from 'astro';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Image from '~/components/common/Image.astro';
import { Icon } from 'astro-icon/components';

import aiEngineerImg from '~/assets/images/ai-engineer.png';
import customSoftwareImg from '~/assets/images/custom-software.png';
import defaultImg from '~/assets/images/diogo-nunes.png';

const { id, isDark = false, classes = {}, bg = await Astro.slots.render('bg') } = Astro.props;

function titleParts(title: string) {
  const i = title.lastIndexOf(' ');
  if (i === -1) return { lead: title, italic: '' };
  return { lead: title.slice(0, i + 1), italic: title.slice(i + 1) };
}

interface ServiceItem {
  title: string;
  description: string;
  icon?: string;
  image?: ImageMetadata;
  gridClass: string;
  bgClass?: string;
  layout?: 'feature' | 'side-image' | 'text-only';
}

// 3×2 grid: AI+Eng (1×2 left) | Custom Software, Blockchain (row1) | Mobile App, Cloud&Ops (row2)
const services: ServiceItem[] = [
  {
    title: 'AI + Engineering',
    description:
      'We create custom, production-ready AI — not demos — with solid MLOps, reliable inference, and features that drive real business impact.',
    gridClass: 'md:col-start-1 md:row-start-1 md:col-span-1 md:row-span-2',
    bgClass: 'bg-indigo-50',
    image: aiEngineerImg,
    layout: 'feature',
  },
  {
    title: 'Cybersecurity',
    description:
      'AI-powered security operations that autonomously detect threats, investigate incidents, and respond in seconds — not reactive alerts.',
    gridClass: 'md:col-start-2 md:row-start-1',
    bgClass: 'bg-red-50',
    image: customSoftwareImg,
    layout: 'side-image',
  },
  {
    title: 'Blockchain Engineering',
    description:
      'Secure, product-driven smart contracts, tokens, and dApps — deployed on the chains that fit your goals.',
    gridClass: 'md:col-start-3 md:row-start-1',
    bgClass: 'bg-green-50',
    layout: 'text-only',
  },
  {
    title: 'Mobile App Development',
    description:
      'Pixel-perfect UX, great performance, and quick launch. We build apps that feel delightful, integrate cleanly, and evolve with data.',
    gridClass: 'md:col-start-2 md:row-start-2',
    bgClass: 'bg-green-50',
    layout: 'text-only',
  },
  {
    title: 'Cloud & Ops',
    description: 'Reliable, efficient cloud infrastructure that makes ops boring and teams fast.',
    gridClass: 'md:col-start-3 md:row-start-2',
    bgClass: 'bg-indigo-50',
    image: defaultImg,
    layout: 'side-image',
  },
];
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-7xl mx-auto ${classes?.container ?? ''}`} bg={bg}>
  <div class="mb-12">
    <h1 class="flex flex-wrap items-baseline gap-x-2 hero-think">
      <span class="font-[700] text-[64px] leading-[108px]">Own the </span>
      <span class="font-normal italic text-[72px] leading-[108px]">digital frontier</span>
    </h1>
    <p class="section-desc font-normal text-[20px] leading-[32px] text-muted mb-8 max-w-3xl">
      Fed up with playing catch-up? We build bold, practical tech that turns ideas into impact — from clever AI that
      actually works to rock-solid systems that scale.
    </p>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 md:grid-rows-2 gap-4 md:auto-rows-fr">
    {
      services.map((item) => (
        <div
          class={`relative flex flex-col rounded-xl overflow-hidden border border-gray-100 transition-all hover:shadow-lg ${item.bgClass ?? ''} ${item.gridClass}`}
        >
          {item.layout === 'feature' && item.image && (
            <div class="flex-shrink-0 w-full aspect-[4/3] overflow-hidden rounded-t-xl">
              <Image
                src={item.image}
                alt={item.title}
                class="w-full h-full object-cover rounded-t-xl transition-transform duration-500 hover:scale-105"
              />
            </div>
          )}

          {item.layout === 'side-image' && item.image && (
            <div class="flex flex-1 min-h-0 p-4 gap-3 md:flex-row flex-col">
              <div class="flex-shrink-0 w-28 h-28 md:w-32 md:h-32 overflow-hidden rounded-lg">
                <Image
                  src={item.image}
                  alt={item.title}
                  class="w-full h-full object-cover rounded-lg transition-transform duration-500 hover:scale-105"
                />
              </div>
              <div class="flex flex-col flex-1 min-w-0">
                <h3 class="text-xl font-bold mb-1 font-serif">
                  {titleParts(item.title).italic ? (
                    <>
                      {titleParts(item.title).lead}
                      <span class="italic font-normal font-serif">{titleParts(item.title).italic}</span>
                    </>
                  ) : (
                    item.title
                  )}
                </h3>
                <p class="text-muted text-sm mb-2 flex-grow">{item.description}</p>
                <a
                  href="#"
                  class="font-bold text-sm text-heading hover:text-primary transition-colors inline-flex items-center mt-auto"
                >
                  Know more <Icon name="tabler:arrow-right" class="w-4 h-4 ml-1" />
                </a>
              </div>
            </div>
          )}

          {item.layout === 'text-only' && (
            <div class="flex flex-col p-4 h-full">
              <h3 class="text-xl font-bold mb-1 font-serif">
                {titleParts(item.title).italic ? (
                  <>
                    {titleParts(item.title).lead}
                    <span class="italic font-normal font-serif">{titleParts(item.title).italic}</span>
                  </>
                ) : (
                  item.title
                )}
              </h3>
              <p class="text-muted text-sm mb-2 flex-grow">{item.description}</p>
              <a
                href="#"
                class="font-bold text-sm text-heading hover:text-primary transition-colors inline-flex items-center mt-auto"
              >
                Know more <Icon name="tabler:arrow-right" class="w-4 h-4 ml-1" />
              </a>
            </div>
          )}

          {item.layout === 'feature' && (
            <div class="flex flex-col p-4 min-h-0">
              <h3 class="text-2xl font-bold mb-2 font-serif">
                {titleParts(item.title).italic ? (
                  <>
                    {titleParts(item.title).lead}
                    <span class="italic font-normal font-serif">{titleParts(item.title).italic}</span>
                  </>
                ) : (
                  item.title
                )}
              </h3>
              <p class="text-muted text-sm mb-3 flex-grow">{item.description}</p>
              <a
                href="#"
                class="font-bold text-sm text-heading hover:text-primary transition-colors inline-flex items-center"
              >
                Know more <Icon name="tabler:arrow-right" class="w-4 h-4 ml-1" />
              </a>
            </div>
          )}
        </div>
      ))
    }
  </div>
</WidgetWrapper>

<style>
  .hero-think {
    font-family: Almarai, ui-sans-serif, sans-serif;
  }
  .section-desc {
    font-family: 'Inter Variable', Inter, ui-sans-serif, sans-serif;
  }
</style>
