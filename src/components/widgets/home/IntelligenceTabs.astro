---
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';

const { id, isDark = false, classes = {}, bg = await Astro.slots.render('bg') } = Astro.props;

const tabs = [
  {
    id: 'tab1',
    label: 'Custom ML & Predictive Analytics',
    subLabel: 'Models that predict, optimize, and scale — not just analyze',
    title: 'AI that delivers business impact — not buzzwords',
    content:
      'We build end-to-end predictive systems—forecasting, churn scoring, risk models, and demand intelligence—so your product can make smarter decisions automatically. Our work includes clean data pipelines, rigorous validation, fast inference services, and dashboards that teams actually use to track performance and impact.',
    tags: ['AI', 'LLM', 'ML'],
    image: 'https://images.unsplash.com/photo-1535378437323-95288ac925b9?q=80&w=1000&auto=format&fit=crop',
  },
  {
    id: 'tab2',
    label: 'Generative AI & LLM Solutions',
    subLabel: 'AI that creates, adapts, and personalizes — not templates',
    title: 'Unlock Creativity at Scale',
    content:
      'Harness the power of Large Language Models to automate content creation, personalize user experiences, and build intelligent assistants. We fine-tune models to your specific domain regarding security and privacy.',
    tags: ['GenAI', 'LLM', 'RAG'],
    image: 'https://images.unsplash.com/photo-1620712943543-bcc4688e7485?q=80&w=1000&auto=format&fit=crop',
  },
  {
    id: 'tab3',
    label: 'Computer Vision & Image Intelligence',
    subLabel: 'Vision AI that interprets and reacts — not just detects',
    title: 'See the World Through Data',
    content:
      'From quality control in manufacturing to facial recognition and object detection. Our computer vision solutions transform pixels into actionable insights with high accuracy and low latency.',
    tags: ['CV', 'OpenCV', 'YOLO'],
    image: 'https://images.unsplash.com/photo-1550751827-4bd374c3f58b?q=80&w=1000&auto=format&fit=crop',
  },
  {
    id: 'tab4',
    label: 'Conversational AI & Virtual Agents',
    subLabel: 'Assistants that understand and resolve — not just respond',
    title: 'Conversations That Convert',
    content:
      'Build next-gen chatbots and voice assistants that understand context, sentiment, and intent. Seamlessly integrated into your customer support and sales workflows.',
    tags: ['NLP', 'Voice', 'Chatbots'],
    image: 'https://images.unsplash.com/photo-1531746790731-6c087fecd65a?q=80&w=1000&auto=format&fit=crop',
  },
];
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-7xl mx-auto ${classes?.container ?? ''}`} bg={bg}>
  <div class="mb-12 flex justify-between items-end">
    <h2 class="text-4xl md:text-5xl font-bold font-serif">
      Intelligence <span class="font-sans font-bold">that performs</span>
    </h2>
    <a
      href="#"
      class="hidden md:inline-block px-6 py-2 rounded-full border border-gray-300 text-sm font-semibold hover:border-primary hover:text-primary transition-colors"
    >
      What do you need?
    </a>
  </div>

  <div class="flex flex-col lg:flex-row gap-12" id="intelligence-tabs">
    {/* Tabs List */}
    <div class="w-full lg:w-1/3 flex flex-col">
      {
        tabs.map((tab, index) => (
          <button
            class={`text-left py-6 border-b border-gray-200 group focus:outline-none transition-colors tab-trigger ${index === 0 ? 'active' : ''}`}
            data-target={tab.id}
          >
            <div class="flex items-start">
              <span class="text-xs font-bold text-gray-400 mr-4 mt-1">0{index + 1}</span>
              <div>
                <h3 class="text-lg font-semibold text-gray-900 group-hover:text-primary transition-colors">
                  {tab.label}
                </h3>
                <p class="text-sm text-gray-500 mt-1">{tab.subLabel}</p>
              </div>
            </div>
          </button>
        ))
      }
    </div>

    {/* Tab Content */}
    <div class="w-full lg:w-2/3">
      <div class="border border-gray-200 rounded-2xl p-2 h-full">
        {
          tabs.map((tab, index) => (
            <div
              id={tab.id}
              class={`tab-content h-full flex flex-col ${index === 0 ? '' : 'hidden'}`}
            >
              <div class="relative h-64 overflow-hidden rounded-xl mb-6">
                <img src={tab.image} alt={tab.title} class="w-full h-full object-cover" />
              </div>
              <div class="p-6 flex-grow flex flex-col">
                <h3 class="text-xl font-bold mb-1 font-serif">
                  <span class="font-sans font-medium text-gray-500">AI that</span>{' '}
                  <span class="italic font-serif">{tab.title.split('—')[0]}</span> —{' '}
                  <span class="text-black font-bold">{tab.title.split('—')[1] || 'Impact'}</span>
                </h3>
                <p class="text-gray-600 text-sm leading-relaxed mb-8 flex-grow">{tab.content}</p>

                <div class="flex items-center justify-between mt-auto">
                    <div class="flex gap-4 text-xs font-medium text-gray-500">
                        <span>Delivered by our in-house AI engineers</span>
                        <span class="font-bold text-black">Typical launch to POC 4-6 weeks</span>
                    </div>
                    <div class="flex gap-2">
                        {tab.tags.map(tag => (
                            <span class="px-3 py-1 rounded-full border border-gray-300 text-[10px] text-gray-600">{tag}</span>
                        ))}
                    </div>
                </div>
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </div>
</WidgetWrapper>

<script>
  // Simple Vanilla JS for Tabs
  document.addEventListener('astro:page-load', () => {
    const triggers = document.querySelectorAll('.tab-trigger');
    const contents = document.querySelectorAll('.tab-content');

    if (triggers.length && contents.length) {
      triggers.forEach((trigger) => {
        trigger.addEventListener('click', () => {
          // Remove active state from all triggers
          triggers.forEach((t) => t.classList.remove('active', 'border-black'));
          triggers.forEach((t) => t.querySelector('h3')?.classList.remove('text-primary'));

          // Add active state to clicked trigger
          trigger.classList.add('active', 'border-black');
          trigger.querySelector('h3')?.classList.add('text-primary');

          // Hide all content
          contents.forEach((c) => c.classList.add('hidden'));

          // Show target content
          const targetId = trigger.getAttribute('data-target');
          const targetContent = document.getElementById(targetId!); // Assert non-null
          if (targetContent) {
            targetContent.classList.remove('hidden');
          }
        });
      });
    }
  });

  // Handle initial load (if ViewTransitions not used or first load)
  // Re-run the logic immediately in case astro:page-load isn't fired
  // (Astro ViewTransitions fires astro:page-load)
</script>

<style>
  .tab-trigger.active {
    border-color: black;
  }
  .tab-trigger.active h3 {
    color: var(--aw-color-primary);
  }
</style>
